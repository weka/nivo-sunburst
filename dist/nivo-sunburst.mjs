import{useMemo as e,createElement as r,forwardRef as o,Fragment as a}from"react";import{usePropertyAccessor as t,useValueFormatter as i,useMotionConfig as n,Container as l,useDimensions as d,bindDefs as s,SvgWrapper as c,ResponsiveWrapper as u}from"@nivo/core";import{useArcGenerator as f,ArcsLayer as v,ArcLabelsLayer as h}from"@nivo/arcs";import{BasicTooltip as b,useTooltip as m}from"@nivo/tooltip";import{jsx as p}from"react/jsx-runtime";import{hierarchy as g,partition as R}from"d3-hierarchy";import{scaleRadial as L}from"d3-scale";import y from"lodash/cloneDeep.js";import C from"lodash/sortBy.js";import{useTheme as M}from"@nivo/theming";import{useOrdinalColorScale as x,useInheritedColor as A}from"@nivo/colors";import{useTransition as k,animated as S,to as I}from"@react-spring/web";function O(e,r){(null==r||r>e.length)&&(r=e.length);for(var o=0,a=Array(r);o<r;o++)a[o]=e[o];return a}function P(e,r){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return(o=o.call(e)).next.bind(o);if(Array.isArray(e)||(o=function(e,r){if(e){if("string"==typeof e)return O(e,r);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?O(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){o&&(e=o);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function W(){return W=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var a in o)({}).hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},W.apply(null,arguments)}function w(e,r){if(null==e)return{};var o={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==r.indexOf(a))continue;o[a]=e[a]}return o}var F={id:"id",value:"value",cornerRadius:0,innerRadius:0,renderRootNode:!1,layers:["arcs","arcLabels","radialLabels"],colors:{scheme:"nivo"},colorBy:"id",inheritColorFromParent:!0,childColor:{from:"color"},borderWidth:1,borderColor:"white",enableArcLabels:!1,enableRadialLabels:!1,radialLabel:"id",radialLabelsRadiusOffset:.5,radialLabelsSkipAngle:10,radialLabelsSkipRadius:0,radialLabelsRotation:0,radialLabelsTextColor:{theme:"labels.text.fill"},arcLabel:"formattedValue",arcLabelsRadiusOffset:.5,arcLabelsSkipAngle:0,arcLabelsSkipRadius:0,arcLabelsTextColor:{theme:"labels.text.fill"},animate:!0,motionConfig:"gentle",transitionMode:"innerRadius",isInteractive:!0,defs:[],fill:[],tooltip:function(e){var r=e.id,o=e.formattedValue,a=e.color;return p(b,{id:r,value:o,enableChip:!0,color:a})},role:"img"},T=function(r){var o=r.data,a=r.id,n=void 0===a?F.id:a,l=r.value,d=void 0===l?F.value:l,s=r.valueFormat,c=r.radius,u=r.cornerRadius,v=void 0===u?F.cornerRadius:u,h=r.innerRadius,b=void 0===h?F.innerRadius:h,m=r.renderRootNode,p=void 0===m?F.renderRootNode:m,k=r.colors,S=void 0===k?F.colors:k,I=r.colorBy,O=void 0===I?F.colorBy:I,P=r.inheritColorFromParent,W=void 0===P?F.inheritColorFromParent:P,w=r.childColor,T=void 0===w?F.childColor:w,z=M(),B=x(S,O),G=A(T,z),j=t(n),E=t(d),N=i(s),H=e((function(){var e,r=y(o),a=g(r).sum(E),t=R().size([2*Math.PI,c*c]),i=p?t(a).descendants():t(a).descendants().slice(1),n=null!=(e=a.value)?e:0,l=C(i,"depth"),d=c*Math.min(b,1),u=l.length>0?l[l.length-1].depth:0,f=L().domain([0,u]).range([d,c]);return l.reduce((function(e,r){var o,a=j(r.data),t=r.value,i=100*t/n,l=r.ancestors().map((function(e){return j(e.data)})),c=p&&0===r.depth,u={startAngle:r.x0,endAngle:r.x1,innerRadius:c?0:f(r.depth-1),outerRadius:c?d:f(r.depth)};r.parent&&(o=e.find((function(e){return e.id===j(r.parent.data)})));var v={id:a,path:l,value:t,percentage:i,formattedValue:s?N(t):i.toFixed(2)+"%",color:"",arc:u,data:r.data,depth:r.depth,height:r.height};return W&&o&&v.depth>1?v.color=G(o,v):v.color=B(v),[].concat(e,[v])}),[])}),[o,c,b,p,E,j,s,N,B,W,G]);return{arcGenerator:f({cornerRadius:v}),nodes:H}},z=function(r){var o=r.nodes,a=r.arcGenerator,t=r.centerX,i=r.centerY,n=r.radius;return e((function(){return{nodes:o,arcGenerator:a,centerX:t,centerY:i,radius:n}}),[o,a,t,i,n])},B=function(o){var a=o.center,t=o.data,i=o.arcGenerator,n=o.borderWidth,l=o.borderColor,d=o.isInteractive,s=o.onClick,c=o.onMouseEnter,u=o.onMouseMove,f=o.onMouseLeave,h=o.tooltip,b=o.transitionMode,g=m(),R=g.showTooltipFromEvent,L=g.hideTooltip,y=e((function(){if(d)return function(e,r){null==s||s(e,r)}}),[d,s]),C=e((function(){if(d)return function(e,o){R(r(h,e),o),null==c||c(e,o)}}),[d,R,h,c]),M=e((function(){if(d)return function(e,o){R(r(h,e),o),null==u||u(e,o)}}),[d,R,h,u]),x=e((function(){if(d)return function(e,r){L(),null==f||f(e,r)}}),[d,L,f]);return p(v,{center:a,data:t,arcGenerator:i,borderWidth:n,borderColor:l,transitionMode:b,onClick:y,onMouseEnter:C,onMouseMove:M,onMouseLeave:x})},G=function(r){var o,a=r.center,i=r.data,l=r.label,d=r.skipAngle,s=r.skipRadius,c=r.radiusOffset,u=r.textColor,f=r.rotation,v=M(),h=n(),b=h.animate,m=h.config,g=A(u,v),R=t(l),L=(null==(o=v.labels)||null==(o=o.text)?void 0:o.fontSize)||11,y=.6*L,C=1.2*L,x=e((function(){for(var e,r=[],o=P(i);!(e=o()).done;){var a=e.value,t=a.arc;if(!(180*(t.endAngle-t.startAngle)/Math.PI<d)){var n=t.outerRadius-t.innerRadius;if(!(n<s)){var l=(t.startAngle+t.endAngle)/2,u=t.innerRadius+(t.outerRadius-t.innerRadius)*c,v=u*Math.sin(l),h=-u*Math.cos(l),b=R(a),m=String(b),p=u*(t.endAngle-t.startAngle),L=n>=C+4?Math.floor((p-8)/y):0,M=p>=C+4?Math.floor((n-8)/y):0,x=m.length,A=void 0,k=void 0;if(L>=x)A=180*l/Math.PI+f,k=m;else if(M>=x)A=180*l/Math.PI-90+f,k=m;else{var S=L>=M;A=S?180*l/Math.PI+f:180*l/Math.PI-90+f;var I=S?L:M;if(I<=3)continue;k=m.slice(0,I-1)+"â€¦"}var O=(A%360+360)%360;O>90&&O<270&&(A+=180);var W=g(a);r.push({id:a.id,x:v,y:h,rotation:A,label:k,color:W})}}}return r}),[i,d,s,c,f,y,C,R,g]),O=k(x,{keys:function(e){return e.id},from:function(e){return{x:0,y:0,rotation:e.rotation,opacity:0}},enter:function(e){return{x:e.x,y:e.y,rotation:e.rotation,opacity:1}},update:function(e){return{x:e.x,y:e.y,rotation:e.rotation,opacity:1}},leave:{opacity:0},config:m,immediate:!b});return p("g",{transform:"translate("+a[0]+", "+a[1]+")",children:O((function(e,r){return p(S.text,{transform:I([e.x,e.y,e.rotation],(function(e,r,o){return"translate("+e+", "+r+") rotate("+o+")"})),textAnchor:"middle",dominantBaseline:"central",opacity:e.opacity,style:W({},v.labels.text,{fill:r.color,pointerEvents:"none"}),children:r.label},String(r.id))}))})},j=["isInteractive","animate","motionConfig","theme","renderWrapper"],E=function(o){var t=o.data,i=o.id,n=void 0===i?F.id:i,l=o.value,u=void 0===l?F.value:l,f=o.innerRadius,v=void 0===f?F.innerRadius:f,b=o.renderRootNode,m=void 0===b?F.renderRootNode:b,g=o.valueFormat,R=o.cornerRadius,L=void 0===R?F.cornerRadius:R,y=o.layers,C=void 0===y?F.layers:y,M=o.colors,x=void 0===M?F.colors:M,A=o.colorBy,k=void 0===A?F.colorBy:A,S=o.inheritColorFromParent,I=void 0===S?F.inheritColorFromParent:S,O=o.childColor,P=void 0===O?F.childColor:O,W=o.borderWidth,w=void 0===W?F.borderWidth:W,j=o.borderColor,E=void 0===j?F.borderColor:j,N=o.margin,H=o.width,X=o.height,Y=o.enableArcLabels,V=void 0===Y?F.enableArcLabels:Y,K=o.arcLabel,D=void 0===K?F.arcLabel:K,U=o.arcLabelsRadiusOffset,$=void 0===U?F.arcLabelsRadiusOffset:U,q=o.arcLabelsSkipAngle,J=void 0===q?F.arcLabelsSkipAngle:q,Q=o.arcLabelsSkipRadius,Z=void 0===Q?F.arcLabelsSkipRadius:Q,_=o.arcLabelsTextColor,ee=void 0===_?F.arcLabelsTextColor:_,re=o.arcLabelsComponent,oe=o.enableRadialLabels,ae=void 0===oe?F.enableRadialLabels:oe,te=o.radialLabel,ie=void 0===te?F.radialLabel:te,ne=o.radialLabelsRadiusOffset,le=void 0===ne?F.radialLabelsRadiusOffset:ne,de=o.radialLabelsSkipAngle,se=void 0===de?F.radialLabelsSkipAngle:de,ce=o.radialLabelsSkipRadius,ue=void 0===ce?F.radialLabelsSkipRadius:ce,fe=o.radialLabelsRotation,ve=void 0===fe?F.radialLabelsRotation:fe,he=o.radialLabelsTextColor,be=void 0===he?F.radialLabelsTextColor:he,me=o.defs,pe=void 0===me?F.defs:me,ge=o.fill,Re=void 0===ge?F.fill:ge,Le=o.transitionMode,ye=void 0===Le?F.transitionMode:Le,Ce=o.isInteractive,Me=void 0===Ce?F.isInteractive:Ce,xe=o.onClick,Ae=o.onMouseEnter,ke=o.onMouseLeave,Se=o.onMouseMove,Ie=o.tooltip,Oe=void 0===Ie?F.tooltip:Ie,Pe=o.role,We=void 0===Pe?F.role:Pe,we=o.forwardedRef,Fe=d(H,X,N),Te=Fe.innerHeight,ze=Fe.innerWidth,Be=Fe.margin,Ge=Fe.outerHeight,je=Fe.outerWidth,Ee=e((function(){return{radius:Math.min(ze,Te)/2,centerX:ze/2,centerY:Te/2}}),[Te,ze]),Ne=Ee.centerX,He=Ee.centerY,Xe=Ee.radius,Ye=T({data:t,id:n,value:u,valueFormat:g,radius:Xe,cornerRadius:L,innerRadius:v,renderRootNode:m,colors:x,colorBy:k,inheritColorFromParent:I,childColor:P}),Ve=Ye.arcGenerator,Ke=Ye.nodes,De=s(pe,Ke,Re,{colorKey:"color",targetKey:"fill"}),Ue={arcs:null,arcLabels:null,radialLabels:null};C.includes("arcs")&&(Ue.arcs=p(B,{center:[Ne,He],data:Ke,arcGenerator:Ve,borderWidth:w,borderColor:E,transitionMode:ye,isInteractive:Me,tooltip:Oe,onClick:xe,onMouseEnter:Ae,onMouseLeave:ke,onMouseMove:Se},"arcs")),V&&C.includes("arcLabels")&&(Ue.arcLabels=p(h,{center:[Ne,He],data:Ke,label:D,radiusOffset:$,skipAngle:J,skipRadius:Z,textColor:ee,transitionMode:ye,component:re},"arcLabels")),ae&&C.includes("radialLabels")&&(Ue.radialLabels=p(G,{center:[Ne,He],data:Ke,label:ie,radiusOffset:le,skipAngle:se,skipRadius:ue,rotation:ve,textColor:be},"radialLabels"));var $e=z({nodes:Ke,arcGenerator:Ve,centerX:Ne,centerY:He,radius:Xe});return p(c,{width:je,height:Ge,defs:De,margin:Be,role:We,ref:we,children:C.map((function(e,o){return void 0!==Ue[e]?Ue[e]:"function"==typeof e?p(a,{children:r(e,$e)},o):null}))})},N=o((function(e,r){var o=e.isInteractive,a=void 0===o?F.isInteractive:o,t=e.animate,i=void 0===t?F.animate:t,n=e.motionConfig,d=void 0===n?F.motionConfig:n,s=e.theme,c=e.renderWrapper,u=w(e,j);return p(l,{isInteractive:a,animate:i,motionConfig:d,theme:s,renderWrapper:c,children:p(E,W({},u,{isInteractive:a,forwardedRef:r}))})})),H=["defaultWidth","defaultHeight","onResize","debounceResize"],X=o((function(e,r){var o=e.defaultWidth,a=e.defaultHeight,t=e.onResize,i=e.debounceResize,n=w(e,H);return p(u,{defaultWidth:o,defaultHeight:a,onResize:t,debounceResize:i,children:function(e){var o=e.width,a=e.height;return p(N,W({},n,{width:o,height:a,ref:r}))}})}));export{G as RadialLabelsLayer,X as ResponsiveSunburst,N as Sunburst,F as defaultProps,T as useSunburst,z as useSunburstLayerContext};
//# sourceMappingURL=nivo-sunburst.mjs.map
